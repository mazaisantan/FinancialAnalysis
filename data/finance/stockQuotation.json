{
    "code": "000000",
    "data": {
        "alias": "行情数据",
        "apiId": 527,
        "cacheUpdateMode": 0,
        "columnParam": 1,
        "command": "from datasrc import DataSrc\nfrom dataset import DataSet\nimport datetime\n\nclass p_sysapi1021:\n    def __init__(self):\n        pass\n\n    def process(self, kwargs):\n        scode,begincode, sdate, edate = None, None, None,None\n        if kwargs.has_key(\"scode\"):\n            scode = kwargs[\"scode\"]\n            begincode = kwargs[\"scode\"]\n        if kwargs.has_key(\"sdate\"):\n            sdate = kwargs[\"sdate\"]\n        if kwargs.has_key(\"edate\"):\n            edate = kwargs[\"edate\"]\n\n        begindate,enddate = None, None\n        if sdate is not None:\n            stdate = sdate\n            if '/' in sdate:\n                sdate = sdate.replace('/', '-')\n            elif '-' in sdate:\n                sdate = sdate\n            elif len(sdate) == 8:\n                sdate = sdate[0:4] + '-' + sdate[4:6] + '-' + sdate[6:9]\n            begindate = datetime.datetime.strptime(sdate, \"%Y-%m-%d\")\n        if edate is not None:    \n            etdate = edate\n            if '/' in edate:\n                edate = edate.replace('/', '-')\n            elif '-' in edate:\n                edate = edate\n            elif len(edate) == 8:\n                edate = edate[0:4] + '-' + edate[4:6] + '-' + edate[6:9]\n            enddate = datetime.datetime.strptime(edate, \"%Y-%m-%d\")\n            \n        str_scode = \"\"\n        scodelist = scode.split(',')\n\n        for scode in scodelist:\n            ascode = \"\"\n            if (scode[0] == '0' or scode[0]=='3' or scode[0]=='2'):\n                ascode = scode + '-SZE'\n            else:\n                ascode = scode + '-SHE'\n            tmpdate = begindate\n            while tmpdate <= enddate:\n                str = ascode + \"-\" + tmpdate.date().strftime(\"%Y-%m-%d\")\n                str_scode = str_scode + \"\\'\" + str + \"\\'\" + \",\"\n                tmpdate += datetime.timedelta(days=1)\n        \n        dtsrc = DataSrc()\n        sqlstr = '''find({\"_id\":{\"$in\":[%s]}})''' % (str_scode)\n        dtset = dtsrc.readdb(sqlstr, \"apimongo\", db_type=2, mtable=\"SYSAPI1005\")\n        if dtset.is_empty():\n            return dtset\n        #return dtset\n            \n\n        mysqlstr = '''find({\"_id\":{\"$in\":[%s]}})''' % (str_scode)\n        myset = dtsrc.readdb(mysqlstr, \"apimongo\", db_type=2, mtable=\"SYSAPI1021\")  \n        if not myset.is_empty():\n            myset.delcol(colname=\"SECCODE\")\n        #return myset\n        \n        \n        mysetDict={}\n        colidx_code,colidx_tdate=0,0\n        for i in range(0,len(myset.names)):\n            if myset.names[i]==\"SCODE\":\n                colidx_code=i\n            if myset.names[i]==\"TRADEDATE\":\n                colidx_tdate=i\n                \n        for i in range(0,len(myset.data)):\n            mysetDict[myset.data[i][colidx_code]+\"-\"+myset.data[i][colidx_tdate]]=myset.data[i]   \n        dtsetPandas=dtset.to_pandas()\n        #dtset.delcol(colname=\"SECCODE\")\n        #dtset.delcol(colname=\"F001D\")\n        for i in range(0,len(dtset.data)):\n            if mysetDict.has_key(dtsetPandas[\"SECCODE\"][i]+\"-\"+dtsetPandas[\"F001D\"][i]):\n                dtset.data[i].extend(mysetDict[dtsetPandas[\"SECCODE\"][i]+\"-\"+dtsetPandas[\"F001D\"][i]])\n            else:\n                if len(myset.names)>0:\n                    dtset.data[i].extend([\"\" for i in range(0,len(myset.names))])                \n                else:\n                    dtset.data[i].extend([\"\" for i in range(0,25)])\n        if len(myset.names)>0:\n            dtset.names.extend(myset.names)\n        else:\n            dtset.names.extend([\"SCODE\",\"TRADEDATE\",\"F024N\",\"F025N\",\"F026N\",\"F027N\",\"F028N\",\"F029N\",\"F030N\",\"F031N\",\"F032N\",\"F033N\",\"F034N\",\"F035N\",\"F036N\",\"F037N\",\"F038N\",\"F039N\",\"F040N\",\"F041N\",\"F042N\",\"F043N\",\"F044N\",\"F045N\",\"F046N\"])\n        if not dtset.is_empty():\n            dtset.delcol(colname=\"SCODE\")\n            dtset.delcol(colname=\"TRADEDATE\")   \n        return dtset",
        "createUser": "admin",
        "dataType": 1,
        "del": 0,
        "fullUrl": "http://webapi.cninfo.com.cn/api/sysapi/p_sysapi1021",
        "funRelStatus": 0,
        "id": 527,
        "inputParameter": "[{\"fieldType\":\"string\",\"fieldChineseName\":\"证券代码\",\"isNeed\":\"1\",\"describe\":\"\",\"fieldName\":\"scode\",\"defaultValue\":\"\",\"checkRule\":\"\"},{\"fieldType\":\"string\",\"fieldChineseName\":\"开始查询时间\",\"isNeed\":\"1\",\"describe\":\"\",\"fieldName\":\"sdate\",\"defaultValue\":\"\",\"checkRule\":\"\"},{\"fieldType\":\"string\",\"fieldChineseName\":\"结速查询时间\",\"isNeed\":\"1\",\"describe\":\"\",\"fieldName\":\"edate\",\"defaultValue\":\"\",\"checkRule\":\"\"},{\"fieldType\":\"string\",\"fieldChineseName\":\"结果集格式\",\"isNeed\":\"0\",\"describe\":\"设置结果返回的格式，可选的有xml、json、csv、dbf\",\"fieldName\":\"format\",\"defaultValue\":\"\",\"checkRule\":\"\"},{\"fieldType\":\"string\",\"fieldChineseName\":\"结果列选择\",\"isNeed\":\"0\",\"describe\":\"选择结果集中所需要的字段，多列用逗号分隔，如@column=a,b\",\"fieldName\":\"@column\",\"defaultValue\":\"\",\"checkRule\":\"\"},{\"fieldType\":\"int\",\"fieldChineseName\":\"结果条数限制\",\"isNeed\":\"0\",\"describe\":\"设置结果返回的条数\",\"fieldName\":\"@limit\",\"defaultValue\":\"\",\"checkRule\":\"\"},{\"fieldType\":\"string\",\"fieldChineseName\":\"结果集排序\",\"isNeed\":\"0\",\"describe\":\"设置结果集的格式，如 @orderby=id:desc  @orderby=id:asc\",\"fieldName\":\"@orderby\",\"defaultValue\":\"\",\"checkRule\":\"\"}]",
        "limitParam": 1,
        "maxRecordsParam": 0,
        "name": "p_sysapi1021",
        "orderbyParam": 1,
        "outputParameter": "[{\"fieldName\":\"SECCODE\",\"fieldChineseName\":\"股票代码\",\"fieldType\":\"VARCHAR\",\"describe\":\"\"},{\"fieldName\":\"SECNAME\",\"fieldChineseName\":\"股票简称\",\"fieldType\":\"VARCHAR\",\"describe\":\"\"},{\"fieldName\":\"F001D\",\"fieldChineseName\":\"交易日期\",\"fieldType\":\"DATE\",\"describe\":\"\"},{\"fieldName\":\"F002V\",\"fieldChineseName\":\"交易所\",\"fieldType\":\"VARCHAR\",\"describe\":\"\"},{\"fieldName\":\"F003N\",\"fieldChineseName\":\"今日开盘价\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F004N\",\"fieldChineseName\":\"最高成交价\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F005N\",\"fieldChineseName\":\"最低成交价\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F006N\",\"fieldChineseName\":\"收盘价\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F007N\",\"fieldChineseName\":\"成交数量\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F008N\",\"fieldChineseName\":\"成交金额\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F009N\",\"fieldChineseName\":\"涨跌\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F010N\",\"fieldChineseName\":\"涨跌幅\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F011N\",\"fieldChineseName\":\"昨收盘价\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F012N\",\"fieldChineseName\":\"总笔数\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F013N\",\"fieldChineseName\":\"发行总股本\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F014N\",\"fieldChineseName\":\"流通股本\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F015N\",\"fieldChineseName\":\"市盈率\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F016N\",\"fieldChineseName\":\"换手率\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F017N\",\"fieldChineseName\":\"5日平均（MA5）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F018N\",\"fieldChineseName\":\"10日平均（MA10）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F019N\",\"fieldChineseName\":\"30日平均（MA30）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F020N\",\"fieldChineseName\":\"120日均价\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F021N\",\"fieldChineseName\":\"52周均价（360日）均价\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F024N\",\"fieldChineseName\":\"本日融资余额\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F025N\",\"fieldChineseName\":\"本日融资买入额\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F026N\",\"fieldChineseName\":\"本日融资偿还额\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F027N\",\"fieldChineseName\":\"本日融券余量\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F028N\",\"fieldChineseName\":\"本日融券卖出量\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F029N\",\"fieldChineseName\":\"本日融券偿还量\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F030N\",\"fieldChineseName\":\"融券余量金额\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F031N\",\"fieldChineseName\":\"融资融券余额\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F032N\",\"fieldChineseName\":\"市盈率LYR\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F033N\",\"fieldChineseName\":\"市盈率TTM\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F034N\",\"fieldChineseName\":\"市盈率LYR（扣非）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F035N\",\"fieldChineseName\":\"市盈率TTM（扣非）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F036N\",\"fieldChineseName\":\"市净率LF\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F037N\",\"fieldChineseName\":\"市销率LYR\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F038N\",\"fieldChineseName\":\"市销率TTM\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F039N\",\"fieldChineseName\":\"市现率LYR（经营）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F040N\",\"fieldChineseName\":\"市现率TTM（经营）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F041N\",\"fieldChineseName\":\"市现率LYR（总）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F042N\",\"fieldChineseName\":\"市现率TTM（总）\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F043N\",\"fieldChineseName\":\"股息率LYR\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F044N\",\"fieldChineseName\":\"股息率TTM\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F045N\",\"fieldChineseName\":\"PEG\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"},{\"fieldName\":\"F046N\",\"fieldChineseName\":\"EV/EBITDA\",\"fieldType\":\"DECIMAL\",\"describe\":\"\"}]",
        "prefixName": "sysapi",
        "status": 1,
        "tbRelStatus": 0,
        "type": 3,
        "updateUser": "admin",
        "url": "p_sysapi1021"
    },
    "msg": "success"
}